## 2025.06.02 - 테스트 전환

아니 TDD한다며;;
<br/>
보니까 TDD가 손에 안잡히는 이유가 있다.

1. 설계를 안함

설계를 하고 그 흐름에 따라 테스트를 작성해나가며 이에 따라 그때 당시에 필요한 기능을 구현해야 driven 개발이 될건데 설계를 안한다

2. 무엇을 검증해야 할지 명확하게 모름

테스트 검증 분류를 명확히 모른다

테스트 검증 분류는 다음과 같다
- 상태 검증
- 행위 검증

이게 또 mockist vs classicist로 보일 수 있지만 사실 두가지 검증이 상황에 따라 필요하다

그렇기 때문에 어떤 상황인지를 이해하고 검증할 필요가 있다

3. 데이터 만들기 귀찮음

솔직히 테스트 데이터 만들기 번거롭다

예상한 값에 대한 빠른 검증을 하려면 테스트 데이터를 매번 만들어 줘야 하는데 다양한 테스트를 하기 위한 테스트 데이터 생성이 번거롭다 보니 손이 잘 안가는것고 없잖아 있다


<br/>

그럼 이 안잡히는 TDD를 어짤까

### 1. 설계
설계를 한다

당연한 말이긴 한데, 무의식중에 일어나는 low level 설계마저도 설계는 설계다

그렇다면 이 작은 설계도 직접 테스트를 작성해야 한다는 말이다

### 2. 검증 분류

검증 분류에 대한 고민할 시간을 갖는다

상태 검증과 행위 검증을 구분하고, 각각의 검증이 필요한 상황을 이해한다

특정 layer에서는 행위 테스트를 하고 특정 layer에서는 상태 테스트를 해야한다는 그런 정해진 방법은 없는거 같다

물론 integration 테스트는 상태 검증을 하는게 맞지만, 그 외의 테스트는 상황에 따라 다른거 같다

### 3. 테스트 데이터

테스트 데이터는 직접 만들어야 할까?

이게 나만 해본 고민이 아닌가 보다

FixtureMonkey같은걸 네이버에선 이미 만들어서 사용하고 있다

하지만 나는 이것보다 더 마음에 드는 라이브러리를 사용하려 한다

이규원님의 [AutoParams](https://autoparams.github.io/)가 그것이다


공식 문서를 참고해서 테스트를 최대한 작성해봐야겠다...


<br/>
(정말 다행인건 사용법이 간단한 편이다)

<br/>

써보니까 생각보다 괜찮다

<br/>

뭔가 사용법 자체도 대충 어노테이션 붙여넣고, 필요한 부분들만 일부 설정하면 대충 돌아간다

<br/>

다만 좀 짜치는건 검증이 필요한, 유의미한 데이터를 필요로 하는 경우에는 결국 직접 유의미한 수준으로 데이터를 만들어야 한다는 점이다

<br/>

뿐만 아니라 Entity를 생성하는 경우에도 살짝 아쉬움이 있다

<br/>

`@AutoParams` 어노테이션을 사용해서 entity를 생성하면 `@GeneratedValue`가 붙은 필드에 대해서는 값을 자동으로 생성하는데, 이게 기존의 데이터베이스 값과 충돌하는 값으로 인지를 하게 되어 update 쿼리를 날리게 된다

<br/>

이 부분은 `@AutoParams` 어노테이션을 사용하지 않고, `Factory`를 사용해서 직접 id 값을 null로 지정해 주어야 하는데 이게 좀 귀찮다

<br/>

그런거 말고는 대체적으로는 만족스럽다

<br/>

이제 귀찮다고 테스트 안하고 넘어가면 안되용~
<br/>
